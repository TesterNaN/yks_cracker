# 一键击碎某考试公司的“全网挑战”考试系统

> 某公司在B站发视频，宣称自己的在线考试系统“滴水不漏”，能检测虚拟机、QQ、多屏幕、远程桌面，并公开“挑战全网”。  
> 既然公开邀约，那咱们就回应一下。这个脚本用200多行Python，让他们引以为傲的检测机制彻底失效。

---

## 背景

刷B站看到一条广告，某厂商高调宣传他们的严肃考试系统：
- 能检测虚拟机、QQ、远程桌面、多显示器
- 任何作弊行为都逃不过
- 末尾放话：“挑战全网，不服来战”

本着技术交流的精神，我把他们的客户端下载下来研究了一番。发现：

- 基于 Electron 开发，代码混淆过
- 资源目录下有个 `fsdeamon.exe`，和网页通过本地端口 `40360` 通信
- 所谓的“环境检测”就是向这个 exe 发请求，只要它返回 `"status": "ok"` 就通过
- 防截图、强制置顶用的是 Electron 的 `setContentProtection` 和 `setAlwaysOnTop`，都写在渲染层的 JavaScript 里

说白了，整个系统的安全核心建立在两个脆弱点上：  
**一个可以被任意伪造的本地服务，和一个放在前端代码里的防护开关。**

---

## 原理

脚本自动化做两件事：

### 1. 伪造服务端，让环境检测永远返回 OK

原来的 `fsdeamon.exe` 负责检测进程、调用摄像头、截图等脏活。  
但考试程序只关心它返回的 HTTP 响应，根本不验证响应是否真的来自那个 exe。

于是我们写了一个冒牌服务器 `fsdeamon.py`：
- 监听 `127.0.0.1:40360`
- 对关键路由（`/check/canenter`、`/check/quit`、`/exam/startup`）固定返回 `"status": "ok"`
- 加守护线程：检测真实 `Fullscreenexammodule.exe` 是否存活，一旦消失冒牌货自动退出，防止露馅
- 用 PyInstaller 打包成 `fsdeamon.exe` 替换原文件

从此，不管系统想检测什么，这边永远回答：“好的，没问题，一切正常。”

### 2. 解除防截图和强制置顶

这两个功能由 Electron 的 `setContentProtection` 和 `setAlwaysOnTop` 实现，调用代码写在 `src/main.js` 里。  
脚本自动解包 `app.asar`，在 `main.js` 中找到这两个函数名，**全部替换成 `setFocusable`**——一个无害的 Electron 函数。  
重新封包后，系统依然以为自己开启了防护，但实际上窗口可以随意截图、不再置顶。

### 3. 全自动化

脚本会自动完成以下步骤：
- 从注册表读取 `hzyks` 协议，定位考试软件安装目录
- 备份原 `app.asar` 和 `fsdeamon.exe`
- 修改 `app.asar` 并重新打包
- 生成冒牌 `fsdeamon.py`，并编译成 `fsdeamon.exe`
- 清理临时文件

**全程无需人工干预，新版本照样通杀。**

---

## 依赖

- Python 3.6+
- 安装以下库（可通过 `requirements.txt` 一键安装）：

```txt
asar
pyinstaller
flask
psutil
```

---

## 使用方法

1. 克隆本仓库，进入目录。
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. **以管理员身份运行**（因为需要操作注册表和考试软件目录）：
   ```bash
   python auto_cracker.py
   ```
4. 脚本会自动找到考试软件安装路径，完成所有修改，并输出类似以下信息：
   ```
   📁 目标目录: D:\Program Files (x86)\yksfullexam\resources
   🎉 所有操作成功完成！
      - app.asar 已修改（原文件已备份为 app.asar.bak）
      - fsdeamon.exe 已备份（如存在）
      - 新的 fsdeamon.exe 已生成
   ```

之后启动考试系统，你会发现：
- 环境检测永远通过
- 防截图失效
- 强制置顶失效
- 可以随意切换窗口、远程桌面、运行QQ等（当然，仅限技术验证）

---

## 注意事项

- **本脚本仅适用于 Windows 系统**，且必须**以管理员权限运行**。
- 脚本会修改考试软件安装目录下的文件，请确保你有该目录的读写权限。
- 如果考试软件更新后脚本失效，欢迎提交 Issue，但大概率依然有效——因为他们的核心设计没改过。
- 本程序仅为PoC，**绝对禁止**将本工具用于实际考试作弊，任何违规使用**后果自负**。

---

## 结语

他们花一年时间开发系统，我花一个下午写脚本。  
新版本还在宣传“安全升级”，脚本依然一键击穿。

事实证明：  
**安全不是堆砌功能，而是设计逻辑。**  
如果从一开始就把信任基础建立在可伪造的本地服务上，再多的补丁也只是表面功夫。

如果你也觉得有趣，欢迎点个 Star ⭐，让更多人看到“挑战”的后续。
